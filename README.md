# Algorithms to Improve Fairness in Medicare Risk Adjustment

This repository contains analytic code for a project examining the potential for modern algorithms to improve fairness for multiple minoritized racial/ethnic groups while maintaining overall performance in Medicare risk adjustment. In this analysis, we established a baseline regression that approximates the least squares regression used by CMS to estimate risk scores for Medicare plan payment risk adjustment. We evaluated two algorithms to achieve fair spending targets: constrained regression and post-processing. We found that constrained regression and post-processing can incorporate fairness objectives in the Medicare risk adjustment algorithm with minimal reduction in overall fit.

Medicare data contain protected health information and cannot be accessed without IRB approval and a Research Identifiable File (RIF) Data Use Agreement with CMS. As a result, no data are made available in this repository, but the code should allow for replication by reserachers with access to the Medicare RIF data.

Our code is written in R version 4.0.3, and we use renv to facilitate reproducibility. To run the entire pipeline including cross-validation, we used a `n1-highmem-96` instance on Google Cloud.

First, we pre-process Medicare data to create our analytic cohorts. Details and SQL queries are [available](sql). To initialize the file structure, first set your base path in `.Renviron` as `MEDICARE_DATA_PATH = "<base_directory>"`. Then run `setup_directories.R` to create the raw data directory and intermediate output directory. Both of these directories will contain protected health information. Next, transfer data pre-processed Medicare data from the google cloud storage bucket to the raw data directory using `gsutil -m cp -r gs://medicare_rif/Raw/<year>/ <data_dir>` in the terminal. Before running the analytic code, prepare R to run Python using reticulate: 1) ensure Python 3.7 is installed `(reticulate::install_python(version = '3.7'))`, and 2) ensure requirements are isntalled `reticulate::virtualenv_create("medicare_risk_adjustment", requirements = "requirements.txt", version = "3.7")`. Finally, to execute the analysis, run [`00_run.R`](R/00_run.R).
